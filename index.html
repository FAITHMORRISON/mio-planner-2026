<!DOCTYPE html>
<html lang="it">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<link rel="apple-touch-icon" sizes="180x180" href="https://cdn-icons-png.flaticon.com/512/2675/2675848.png">
<link rel="icon" type="image/png" sizes="32x32" href="https://cdn-icons-png.flaticon.com/512/2675/2675848.png">
<title>Planner Obiettivi 2026 - Zen Colorato</title>
<style>
body {
  font-family: -apple-system, system-ui, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
  background:#fdfbf5;
  color:#4a4a4a;
  font-size: 16px;
  line-height: 1.5;
  max-width: 800px;
  margin: 20px auto; 
  padding: 0 15px;
}
h1 { text-align:center; margin-bottom:30px; color:#555; font-size: 1.5rem; }
h2,h3,h4,h5 {
  cursor:pointer; padding: 12px 15px; border-radius:10px; margin: 10px 0;
  transition: all 0.2s ease; border-bottom: 1px solid rgba(0,0,0,0.05); line-height: 1.3;
}
h2:hover, h3:hover, h4:hover, h5:hover { transform: translateY(-1px); box-shadow: 0 2px 5px rgba(0,0,0,0.1); }
h2[data-color="salute"] { background:#f0e3cf; }
h2[data-color="vita"] { background:#e2ded6; }
h2[data-color="acquisti"] { background:#d9e2d0; }
h2[data-color="lifestyle"] { background:#f5f2e7; }
h2[data-color="viaggi"] { background:#fef7e5; }
h2[data-color="eventi"] { background:#e3e7de; }
h2[data-color="libero"] { background:#fdf9f0; }
h3 { background:#e0d8c4; margin-left:10px; }
h4 { background:#d0dec4; margin-left:20px; }
h5 { background:#f0efe5; margin-left:30px; }
ul { list-style:none; padding-left:10px; margin:5px 0; }
.collapsible-content { display:none; }
li { padding: 8px 0; display:flex; align-items:center; flex-wrap: wrap; border-bottom: 1px solid #eee; }
button { margin: 4px 2px; padding: 8px 12px; font-size: 14px; border-radius:8px; border:none; background:#e6e2d3; cursor:pointer; }
input[type="checkbox"] { transform: scale(1.2); margin-right:10px; }
.note { font-style:italic; color:#666; margin-left: 10px; font-size: 0.9em; flex-basis: 100%; margin-top: 5px;}
.date { color:#3a7dcb; font-size: 0.9em; margin-left: 10px; font-weight: bold;}
.flag { font-size: 1.2em; margin-left:10px; cursor:pointer; }
.add-item-btn { background:#cfd8d2; font-weight: bold; }
.delete-item-btn { background:#f4b4b4; color: #721c24; margin-left: auto;}
.sync-btn { position: fixed; bottom: 25px; right: 25px; width: 60px; height: 60px; border-radius: 50%; background: #4a4a4a; color: white; border: none; cursor: pointer; box-shadow: 0 4px 15px rgba(0,0,0,0.3); z-index: 10000; font-size: 26px; display: flex; align-items: center; justify-content: center; }
</style>
</head>
<body>

<h1>Planner Obiettivi 2026 - Zen Colorato</h1>
<button class="sync-btn" onclick="salvaSuCloud()">‚òÅÔ∏è</button>
<div id="planner"></div>

<script>
const SCRIPT_URL = "https://script.google.com/macros/s/AKfycbzf2V7uR83vAiSN4kMm4IWuSokQG1p8vq9ULZ8rP9KhkJGdrZDW22iR7k0fkMWIp61vdQ/exec";

let planner = [
  { titolo:"‚ù§Ô∏è Salute & Corpo", colore:"salute", sottoCategorie:[
      { titolo:"Visite mediche", sottoCategorie:[
          { titolo:"Gastroenterologo (Ortona)", obiettivi:[{testo:"Controllo referto online ASL Abruzzo"},{testo:"Telefonata per risultati"},{testo:"Ricerca / lista gastroenterologi"},{testo:"Note e referti"}] },
          { titolo:"Ginecologo", sottoCategorie:[
              { titolo:"Ricerca specialista", obiettivi:[{testo:"Michele Moncelli"},{testo:"Marina Cortesi"},{testo:"Daniele Mautone (Artemisia)"},{testo:"Carlo De Cicco"},{testo:"Massimiliano Marziali"},{testo:"Manuel Ianieri"}] },
              { titolo:"Temi da approfondire", obiettivi:[{testo:"Endometriosi"},{testo:"Insulino-resistenza"},{testo:"Terapia ormonale (valutazioni)"},{testo:"Dieta per endometriosi"},{testo:"Fertilit√† / salute ovarica"}] },
              { titolo:"Esami da discutere", obiettivi:[{testo:"Trombofilia (pre-terapia ormonale)"},{testo:"Risonanza magnetica pelvica"},{testo:"Marker ovarici CA125"}] },
              { titolo:"Note post-visita", obiettivi:[] },
              { titolo:"Referti", obiettivi:[{testo:"Contattare ASL Lazio ‚Äì esito HPV test"}] }
          ]},
          { titolo:"Urologo", obiettivi:[{testo:"Calcolo renale"},{testo:"Esami / indicazioni"}] },
          { titolo:"Ematologo / Genetista", obiettivi:[{testo:"Esami genetici trombofilia"},{testo:"Familiarit√†"}] },
          { titolo:"Endocrinologo", obiettivi:[{testo:"Visita Ospedale di Atri"},{testo:"Data: 9 marzo"}] },
          { titolo:"Dermatologo", obiettivi:[{testo:"Bolle cutanee ricorrenti"},{testo:"Diagnosi / terapia"}] },
          { titolo:"Senologia", obiettivi:[{testo:"Prima ecografia senologica"},{testo:"Prenotazione entro l‚Äôanno"}] },
          { titolo:"Psicoterapia", obiettivi:[{testo:"Ricerca psicoterapeuta"},{testo:"Bonus psicologico"},{testo:"Avvio percorso terapeutico"}] }
      ]},
      { titolo:"Analisi ed esami", obiettivi:[{testo:"Ferro e ferritina"},{testo:"Marker ovarici CA125"},{testo:"Risonanza magnetica pelvica"}] },
      { titolo:"Fisioterapia & Movimento", sottoCategorie:[
          { titolo:"Fisioterapia prescritta dal fisiatra", obiettivi:[{testo:"Inizio: febbraio"}] },
          { titolo:"Posturale", obiettivi:[] },
          { titolo:"Ripresa attivit√† sportiva", obiettivi:[] }
      ]},
      { titolo:"Estetica & Cura del corpo", sottoCategorie:[
          { titolo:"Capelli", obiettivi:[{testo:"Ricerca salone fidato a Roma"},{testo:"Percorso di cura graduale"},{testo:"Tornare bionda"}] },
          { titolo:"Viso", obiettivi:[{testo:"Filler di rinfresco"},{testo:"Riferimento: Dott.ssa Valentina (Pescara)"}] }
      ]}
  ]},
  { titolo:"üìÖ Vita pratica & Scadenze", colore:"vita", sottoCategorie:[
      { titolo:"Abbonamenti & digitale", obiettivi:[{testo:"Benzina Enilive"},{testo:"Chat Apple"},{testo:"Riduzione iCloud"},{testo:"Backup KDrive"}] },
      { titolo:"Concorsi pubblici", obiettivi:[{testo:"Agenzia delle Entrate"},{testo:"INPS"},{testo:"Comune di Roma"},{testo:"MIC (entro 10 gen)"}] },
      { titolo:"Documenti", obiettivi:[{testo:"Rinnovo patente (marzo)"}] }
  ]},
  { titolo:"üõçÔ∏è Acquisti & Outfit", colore:"acquisti", sottoCategorie:[
      { titolo:"Acquisti graduali 2026", obiettivi:[] },
      { titolo:"Cura capelli", obiettivi:[{testo:"Ricerca spazzole"}] }
  ]},
  { titolo:"üé® Lifestyle / Hobby", colore:"lifestyle", sottoCategorie:[
      { titolo:"Crescita", obiettivi:[{testo:"Eliminare persone nocive"}] },
      { titolo:"Studio", obiettivi:[{testo:"AI"},{testo:"ML"}] }
  ]},
  { titolo:"‚úàÔ∏è Viaggi / Luoghi", colore:"viaggi", sottoCategorie:[
      { titolo:"Torino", obiettivi:[] },
      { titolo:"Barcellona (febbraio)", obiettivi:[] },
      { titolo:"Abruzzo", obiettivi:[{testo:"Ortona"},{testo:"Museo Barbella"}] }
  ]},
  { titolo:"üß≠ PLANNER LIBERO", colore:"libero", sottoCategorie:[
      { titolo:"Spazio aperto", obiettivi:[] }
  ]}
];

// Caricamento Dati
if(localStorage.getItem('planner')) {
    try { planner = JSON.parse(localStorage.getItem('planner')); } catch(e){ console.error(e); }
}

function salvaPlanner() { localStorage.setItem('planner', JSON.stringify(planner)); }

function renderizzaTutto() {
    const p = document.getElementById('planner');
    p.innerHTML = '';
    creaListaRec(planner, p);
}

function creaListaRec(arr, container, livello=2){
  arr.forEach((item, i) => {
    const h = document.createElement('h'+livello);
    h.textContent = item.titolo;
    if(livello===2 && item.colore) h.dataset.color = item.colore;
    h.classList.add('collapsible');
    container.appendChild(h);

    const ul = document.createElement('ul');
    ul.classList.add('collapsible-content');

    (item.obiettivi || []).forEach((obj, j) => {
      // Conversione stringhe vecchie in oggetti
      if (typeof obj === 'string') {
          obj = { testo: obj, completato: false, nota: "", data: "", flag: false };
          item.obiettivi[j] = obj;
      }

      const li = document.createElement('li');
      
      const check = document.createElement('input');
      check.type = 'checkbox';
      check.checked = obj.completato || false;
      check.onchange = () => { obj.completato = check.checked; salvaPlanner(); };
      li.appendChild(check);

      const txt = document.createElement('span');
      txt.textContent = obj.testo;
      li.appendChild(txt);

      // Flag
      const f = document.createElement('span');
      f.className = 'flag';
      f.textContent = obj.flag ? '‚úÖ' : 'üî¥';
      f.onclick = () => { obj.flag = !obj.flag; f.textContent = obj.flag ? '‚úÖ' : 'üî¥'; salvaPlanner(); };
      li.appendChild(f);

      // Data
      const bD = document.createElement('button');
      bD.textContent = 'üìÖ';
      bD.onclick = () => { 
          const res = prompt('Data:', obj.data || ""); 
          if(res !== null) { obj.data = res; salvaPlanner(); renderizzaTutto(); }
      };
      li.appendChild(bD);

      // Nota
      const bN = document.createElement('button');
      bN.textContent = '+ Nota';
      bN.onclick = () => { 
          const res = prompt('Nota:', obj.nota || ""); 
          if(res !== null) { obj.nota = res; salvaPlanner(); renderizzaTutto(); }
      };
      li.appendChild(bN);

      // Delete
      const bDel = document.createElement('button');
      bDel.textContent = 'üóëÔ∏è';
      bDel.className = 'delete-item-btn';
      bDel.onclick = () => { item.obiettivi.splice(j, 1); salvaPlanner(); renderizzaTutto(); };
      li.appendChild(bDel);

      if(obj.data) {
          const sD = document.createElement('span'); sD.className = 'date';
          sD.textContent = ' ‚è≥ ' + obj.data; li.appendChild(sD);
      }
      if(obj.nota) {
          const sN = document.createElement('div'); sN.className = 'note';
          sN.textContent = 'üìù Note: ' + obj.nota; li.appendChild(sN);
      }
      ul.appendChild(li);
    });

    const bAdd = document.createElement('button');
    bAdd.textContent = '+ Aggiungi';
    bAdd.className = 'add-item-btn';
    bAdd.onclick = () => {
        const n = prompt('Cosa aggiungere?');
        if(n) { item.obiettivi.push({testo: n, completato: false, nota:"", data:"", flag:false}); salvaPlanner(); renderizzaTutto(); }
    };
    ul.appendChild(bAdd);

    if(item.sottoCategorie) creaListaRec(item.sottoCategorie, ul, livello+1);
    container.appendChild(ul);
  });
}

renderizzaTutto();

document.addEventListener('click', e => {
  if(e.target.classList.contains('collapsible')){
    const nextUl = e.target.nextElementSibling;
    if(nextUl) nextUl.style.display = nextUl.style.display==='block' ? 'none' : 'block';
  }
});

async function salvaSuCloud() {
    const btn = document.querySelector('.sync-btn');
    btn.textContent = "‚è≥";
    try {
        await fetch(SCRIPT_URL, { method: 'POST', mode: 'no-cors', body: JSON.stringify(planner) });
        alert("‚úÖ Sincronizzato!");
    } catch (e) { alert("‚ùå Errore"); }
    btn.textContent = "‚òÅÔ∏è";
}

async function caricaDaCloud() {
    try {
        const response = await fetch(SCRIPT_URL);
        const text = await response.text();
        if (text && text.length > 50) {
            planner = JSON.parse(text);
            salvaPlanner();
            renderizzaTutto();
        }
    } catch (e) { console.log("Cloud vuoto"); }
}
caricaDaCloud();
</script>
</body>
</html>
